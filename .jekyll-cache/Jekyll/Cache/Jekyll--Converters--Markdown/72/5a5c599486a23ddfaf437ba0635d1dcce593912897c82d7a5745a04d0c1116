I"’<p>C++ ì•„ë‹ˆê³  Cë¡œ ì†Œì¼“í†µì‹  ì‘ì„±í•˜ê¸°! <br /></p>

<h2 id="ë¬¸ì œ-ì •ì˜">ë¬¸ì œ ì •ì˜</h2>

<p>ì„œë²„ ì—­í• : <code class="language-plaintext highlighter-rouge">read</code> <br />
ì›í•˜ëŠ” ë©”ì„¸ì§€ë¥¼ read í•´ë³´ì <br /></p>

<h2 id="ì½”ë“œ">ì½”ë“œ</h2>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">error_handling</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">fputs</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
  <span class="n">fputc</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">serv_sock</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

  <span class="c1">// ì†Œì¼“ FD ìƒì„±</span>
  <span class="n">serv_sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">PF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">serv_sock</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">error_handling</span><span class="p">(</span><span class="s">"socket() error"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// ì£¼ì†Œ ì •ë³´ ì´ˆê¸°í™”</span>
  <span class="k">struct</span> <span class="nc">sockaddr_in</span> <span class="n">serv_addr</span><span class="p">,</span> <span class="n">clnt_addr</span><span class="p">;</span>
  <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">serv_addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">serv_addr</span><span class="p">));</span>
  <span class="n">serv_addr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
  <span class="n">serv_addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="n">ip</span><span class="p">);</span>
  <span class="n">serv_addr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>


  <span class="c1">// ì†Œì¼“ì— ìœ„ì—ì„œ ìƒì„±í•œ ì£¼ì†Œ ì •ë³´ë¥¼ í• ë‹¹</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">serv_sock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="nc">sockaddr</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">serv_addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">serv_addr</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">error_handling</span><span class="p">(</span><span class="s">"bind() error"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²° ìš”ì²­ì´ ê°€ëŠ¥í•˜ë„ë¡ 5í¬ê¸°ì˜ ëŒ€ê¸°ì‹¤ ìƒì„±</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">listen</span><span class="p">(</span><span class="n">serv_sock</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">error_handling</span><span class="p">(</span><span class="s">"listen() error"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// accept() í•¨ìˆ˜ í˜¸ì¶œì„ í•´ì„œ ì‹¤ì œ ë°ì´í„°ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ì†Œì¼“ì„ ìƒì„±</span>
  <span class="n">socklen_t</span> <span class="n">clnt_addr_size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">clnt_addr</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">clnt_sock</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">serv_sock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="nc">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span> <span class="n">clnt_addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">clnt_addr_size</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">clnt_sock</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">error_handling</span><span class="p">(</span><span class="s">"accept() error"</span><span class="p">);</span>
  <span class="p">}</span>    

  <span class="c1">// ì„±ê³µì ìœ¼ë¡œ ì„œë²„ì—ê²Œì„œ ë©”ì‹œì§€ë¥¼ ë°›ì•„ì˜¤ë©´</span>
  <span class="c1">// 0ì„ ë°˜í™˜í•˜ê³  ì‹¤íŒ¨í•˜ë©´ -1ì„ ë°˜í™˜í•œë‹¤.</span>
  <span class="kt">char</span> <span class="n">message</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">str_len</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">str_len</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">clnt_sock</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Send message to server: %s </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="reference">Reference</h2>
<ul>
  <li><a href="https://const-human.tistory.com/12">â€œ[Linux]TCP ì„œë²„/í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„â€</a></li>
</ul>
:ET