I"á8<p><br /></p>

<p>ROS tf treeë¥¼ ì•Œì•„ë³´ì!</p>

<h2 id="ros-tf-tree">ROS tf tree</h2>

<p>Robot systemì—ëŠ” ìˆ˜ë§ì€ 3D coordinatesë“¤ì´ ì¡´ì¬</p>

<p>tfëŠ” ë§ì€ frameë“¤ì„ ê³„ì† trackingí•˜ì—¬ frameë“¤ê°„ ìƒëŒ€ì ì¸ ìœ„ì¹˜ë¥¼ ê³„ì† ê¸°ë¡</p>

<p><strong>tfëŠ” distributed systemì—ì„œ êµ¬ë™</strong>ë˜ê¸° ë•Œë¬¸ì—, ë¡œë´‡ì˜ coordinateì— ëŒ€í•œ ëª¨ë“  ì •ë³´ëŠ” ë‹¤ë¥¸ ëª¨ë“  ROS componentë“¤ë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ</p>

<p>ì¦‰, transform informationì˜ ì¤‘ì‹¬ì„œë²„ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ</p>

<p><br /></p>

<p><img src="/assets/img/blog/ros/2022-01-21/01.png" alt="01" /></p>

<p>ì—¬ê¸°ì„œ ë¡œë´‡ì˜ ì‹¤ì œ ì¤‘ì‹¬ëŠ” <code class="language-plaintext highlighter-rouge">base_link</code>ì´ê³  ìŠ¤ìºë„ˆì˜ ì¢Œí‘œ ì¤‘ì‹¬ì€ <code class="language-plaintext highlighter-rouge">base_laser</code>ì„</p>

<p>ë”°ë¼ì„œ ë¼ì´ë‹¤ë¡œë¶€í„° ìŠ¤ìº”ëœ ì •ë³´ë¥¼ ë¡œë´‡ ì¤‘ì‹¬ì—ì„œì˜ ì¢Œí‘œë¡œ <strong>transformationí•˜ëŠ” ê³¼ì •</strong>ì´ í•„ìš”í•¨!</p>

<p><br /></p>

<p><code class="language-plaintext highlighter-rouge">odom</code> -&gt; <code class="language-plaintext highlighter-rouge">base_footprint</code> -&gt; <code class="language-plaintext highlighter-rouge">base_link</code> -&gt; <code class="language-plaintext highlighter-rouge">sensor_link</code> ìˆœì´ë‹¤!!! <br /></p>

<p>ì´ë¥¼ ì‰½ê²Œ í•´ì£¼ëŠ” ê²ƒì´ ë°”ë¡œ <strong>tf library</strong> ì„</p>

<p><br /></p>

<h2 id="1-writing-code">1. Writing Code</h2>

<p>In ${workspace}/src</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>catkin_create_pkg robot_setup_tf roscpp tf geometry_msgs
</code></pre></div></div>

<p><br /></p>

<h2 id="2-broadcasting-a-transform">2. Broadcasting a Transform</h2>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;ros/ros.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;tf/transform_broadcaster.h&gt;</span><span class="cp">
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">"tf_broadcaster"</span><span class="p">);</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">nh</span><span class="p">;</span>

  <span class="n">ros</span><span class="o">::</span><span class="n">Rate</span> <span class="n">r</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

  <span class="n">tf</span><span class="o">::</span><span class="n">TransformBroadcaster</span> <span class="n">broadcaster</span><span class="p">;</span>

  <span class="k">while</span><span class="p">(</span><span class="n">nh</span><span class="p">.</span><span class="n">ok</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="n">broadcaster</span><span class="p">.</span><span class="n">sendTransform</span><span class="p">(</span>
      <span class="n">tf</span><span class="o">::</span><span class="n">StampedTransform</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">::</span><span class="n">Transform</span><span class="p">(</span><span class="n">tf</span><span class="o">::</span><span class="n">Quaternion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">tf</span><span class="o">::</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)),</span>
        <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">::</span><span class="n">now</span><span class="p">(),</span> <span class="s">"based_link"</span><span class="p">,</span> <span class="s">"base_laser"</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>TransformBroadcasterë¥¼ í†µí•´ transformì„ ì†¡ì‹ í•˜ë ¤ë©´ <strong>5ê°œì˜ argument</strong>ê°€ í•„ìš”</p>

<p><br /></p>

<h2 id="3-listening-a-transform">3. Listening a Transform</h2>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">#include</span> <span class="cpf">&lt;ros/ros.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;tf/transform_listener.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;geometry_msgs/PointStamped.h&gt;</span><span class="cp">
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">transformPoint</span><span class="p">(</span><span class="k">const</span> <span class="n">tf</span><span class="o">::</span><span class="n">TransformListener</span><span class="o">&amp;</span> <span class="n">listener</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">geometry_msgs</span><span class="o">::</span><span class="n">PointStamped</span> <span class="n">laser_point</span><span class="p">;</span>
  <span class="n">laser_point</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">"base_laser"</span><span class="p">;</span>

  <span class="n">laser_point</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">();</span>

  <span class="c1">// just an arbitrary point</span>
  <span class="n">laser_point</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="n">laser_point</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>
  <span class="n">laser_point</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

  <span class="k">try</span>
  <span class="p">{</span>
    <span class="n">geometry_msgs</span><span class="o">::</span><span class="n">PointStamped</span> <span class="n">base_point</span><span class="p">;</span>
    <span class="n">listener</span><span class="p">.</span><span class="n">transformPoint</span><span class="p">(</span><span class="s">"based_link"</span><span class="p">,</span> <span class="n">laser_point</span><span class="p">,</span> <span class="n">base_point</span><span class="p">);</span>

    <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">"base_laser: (%.2f, %.2f. %.2f) -----&gt; base_link: (%.2f, %.2f, %.2f) at time %.2f"</span><span class="p">,</span>
           <span class="n">laser_point</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">laser_point</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">laser_point</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">z</span><span class="p">,</span>
           <span class="n">base_point</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">base_point</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">base_point</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">base_point</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">());</span>
    
    
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="n">tf</span><span class="o">::</span><span class="n">TransformException</span><span class="o">&amp;</span> <span class="n">ex</span><span class="p">)</span> <span class="c1">//catch(const std::exception&amp; e)</span>
  <span class="p">{</span>
    <span class="c1">// std::cerr &lt;&lt; e.what() &lt;&lt; '\n';</span>
    <span class="n">ROS_ERROR</span><span class="p">(</span><span class="s">"Received an exception trying to transform a point from </span><span class="se">\"</span><span class="s">base_laser</span><span class="se">\"</span><span class="s"> to </span><span class="se">\"</span><span class="s">base_link</span><span class="se">\"</span><span class="s">: %s"</span><span class="p">,</span> <span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">());</span>
  <span class="p">}</span>
  
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">"tf_listener"</span><span class="p">);</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">nh</span><span class="p">;</span>

  <span class="n">tf</span><span class="o">::</span><span class="n">TransformListener</span> <span class="n">listener</span><span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>

  <span class="c1">// 1ì´ˆì— a pointë¥¼ Transform í•  ê±°ì„</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">Timer</span> <span class="n">timer</span> <span class="o">=</span> <span class="n">nh</span><span class="p">.</span><span class="n">createTimer</span><span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">boost</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">transformPoint</span><span class="p">,</span> <span class="n">boost</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">listener</span><span class="p">)));</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>tf::TransformListener ê°ì²´ëŠ” ìë™ìœ¼ë¡œ ROS í™˜ê²½ì— ì¡´ì¬í•˜ëŠ” transform messageë¥¼ subscribeí•˜ê³ , ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  transform ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—­í•  ìˆ˜í–‰</li>
  <li>transformPointí•¨ìˆ˜ëŠ” systemì˜ main()ì•ˆì— ìˆëŠ” ros::Timerì— ëŒ€í•œ callback()</li>
</ul>

<p><br /></p>

<h2 id="4-cmakeliststxt">4. CMakeLists.txt</h2>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">add_executable</span><span class="p">(</span>tf_broadcaster src/tf_broadcaster.cpp<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span>tf_broadcaster
  <span class="si">${</span><span class="nv">catkin_LIBRARIES</span><span class="si">}</span>
<span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span>tf_listener src/tf_listener.cpp<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span>tf_listener
  <span class="si">${</span><span class="nv">catkin_LIBRARIES</span><span class="si">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="5-run">5. Run</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>roscore
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rosrun robot_tf_tutorial tf_broadcaster
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rosrun robot_tf_tutorial tf_listener
</code></pre></div></div>

<p><br /></p>

<h2 id="6-easy">6. EASY</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  <span class="c">&lt;!-- Create a transform sender for linking these frames. --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"tf_footprint_base"</span> <span class="na">pkg=</span><span class="s">"tf"</span> <span class="na">type=</span><span class="s">"static_transform_publisher"</span> <span class="na">args=</span><span class="s">"0 0 0 0 0 0 base_footprint base_link 40"</span> <span class="nt">/&gt;</span>	

</code></pre></div></div>

<p>ì´ê±¸ë¡œ ì‰½ê²Œ í•˜ìâ€¦. <br />
x y z r p y frame_id child_id Hz <br /></p>

<h2 id="reference">Reference</h2>
<ul>
  <li><a href="https://velog.io/@richard7714/ROS-Navigation-tf">ROS Navigation - tf</a></li>
</ul>
:ET