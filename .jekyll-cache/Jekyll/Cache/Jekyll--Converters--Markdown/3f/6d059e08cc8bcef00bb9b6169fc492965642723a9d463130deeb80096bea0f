I"àA<p>sensor_msgs::PointCloudë¡œë¶€í„° ë¼ì´ë‹¤ ë°ì´í„°ë¥¼ íŒŒì‹±í•´ë³´ì</p>

<h2 id="ê°œìš”">ê°œìš”</h2>

<p>ì•„ë˜ ì‚¬ì§„ì—ì„œ <strong>Num of fields</strong>ì— ë³´ë©´ 9ë¼ê³  ì í˜€ ìˆëŠ”ë°, ë¼ì´ë‹¤ í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ì•ˆì— 9ê°€ì§€ ì†ì„±ì´ ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤. <br />
<img src="/assets/img/pcl/Selection_001.png" alt="" /></p>

<ul>
  <li>x, y, z</li>
  <li>intensity</li>
  <li>t</li>
  <li>reflectivity</li>
  <li>ring</li>
  <li>noise</li>
  <li>range</li>
</ul>

<p>ê±°ë‘ì ˆë¯¸í•˜ê³  ë°”ë¡œ íŒŒì‹±í•´ë³´ì <br />
ROS ìˆ™ë ¨ìì„ì„ ê°€ì •í•˜ê³  ê¸€ì„ ì‘ì„±í•œë‹¤ <br /></p>

<h2 id="ì½”ë“œ">ì½”ë“œ</h2>

<p>sensor_msgs::PointCloud2 ë©”ì„¸ì§€ê°€ ìˆ˜ì‹ ë˜ì—ˆì„ ë•Œ í—¤ë”ë¥¼ ì¶œë ¥í•˜ê³ , <code class="language-plaintext highlighter-rouge">data</code>ì— ë‹´ê²¨ìˆëŠ” ì •ë³´ë“¤ì„ íŒŒì‹±í•˜ëŠ” ì½”ë“œë‹¤</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">printAllCloudProperties</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">PointCloud2</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&amp;</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">--- header"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"  frame_id      : "</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"  seq           : "</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">seq</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"  stamp         : "</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"  width         : "</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"  height        : "</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">height</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"  point_step    : "</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">point_step</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"  row_step      : "</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">row_step</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"  Size          : "</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">row_step</span> <span class="o">*</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">height</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"  Num of fields : "</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

  <span class="kt">int</span> <span class="n">offset_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">offset_intensity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">offset_t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">offset_reflectivity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">offset_ring</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">offset_noise</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">offset_range</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"  [Name], [Offset]"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="n">field</span> <span class="o">:</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"  ["</span> <span class="o">&lt;&lt;</span> <span class="n">field</span><span class="p">.</span><span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">"]["</span> <span class="o">&lt;&lt;</span> <span class="n">field</span><span class="p">.</span><span class="n">offset</span> <span class="o">&lt;&lt;</span> <span class="s">"]"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"x"</span><span class="p">)</span> <span class="n">offset_x</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"y"</span><span class="p">)</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"z"</span><span class="p">)</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"intensity"</span><span class="p">)</span> <span class="n">offset_intensity</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"t"</span><span class="p">)</span> <span class="n">offset_t</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"reflectivity"</span><span class="p">)</span> <span class="n">offset_reflectivity</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"ring"</span><span class="p">)</span> <span class="n">offset_ring</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"noise"</span><span class="p">)</span> <span class="n">offset_noise</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"range"</span><span class="p">)</span> <span class="n">offset_range</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZI</span><span class="o">&gt;::</span><span class="n">Ptr</span> <span class="n">cloud</span> <span class="p">(</span><span class="k">new</span> <span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZI</span><span class="o">&gt;</span><span class="p">());</span>

  <span class="n">cloud</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">"os1_lidar"</span><span class="p">;</span>
  <span class="n">cloud</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">row_step</span><span class="p">);</span>

  <span class="kt">int</span> <span class="n">bytes_per_point</span> <span class="o">=</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">point_step</span><span class="p">;</span> <span class="c1">// 48</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">*</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZI</span> <span class="n">new_point</span><span class="p">;</span>

    <span class="n">new_point</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span>  <span class="o">*</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bytes_per_point</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">offset_x</span><span class="p">);</span>
    <span class="n">new_point</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span>  <span class="o">*</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bytes_per_point</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">offset_y</span><span class="p">);</span>
    <span class="n">new_point</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span>  <span class="o">*</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bytes_per_point</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">offset_z</span><span class="p">);</span>
    <span class="n">new_point</span><span class="p">.</span><span class="n">intensity</span> <span class="o">=</span>  <span class="o">*</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bytes_per_point</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">offset_intensity</span><span class="p">);</span>
    
    <span class="n">cloud</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">new_point</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="reference">Reference</h2>
<ul>
  <li><a href="https://answers.ros.org/question/307881/failed-to-find-match-for-field-intensity-with-ouster-lidar/">Failed to find match for field â€˜intensityâ€™ with Ouster LIDAR</a></li>
</ul>
:ET